<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê±´ì¶•ë¬¼ëŒ€ì¥ ì¡°íšŒ ì„œë¹„ìŠ¤ - bd_hub</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; line-height: 1.6; max-width: 700px; margin: auto; }
        .search-container { background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #dee2e6; }
        #address-display { font-weight: bold; color: #007bff; margin: 10px 0; }
        .btn { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
        .btn:hover { background: #0056b3; }
        #result-area { border: 1px solid #dee2e6; padding: 20px; border-radius: 10px; min-height: 150px; }
        .info-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .info-table th, .info-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        .info-table th { background-color: #f2f2f2; width: 30%; }
        .error { color: #dc3545; font-weight: bold; }
    </style>
</head>
<body>
    <h1>ğŸ¢ ê±´ì¶•ë¬¼ëŒ€ì¥ ì¡°íšŒ</h1>
    <p>ë„ë¡œëª…ì£¼ì†Œì™€ ì§€ë²ˆì£¼ì†Œ ëª¨ë‘ ê²€ìƒ‰ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>

    <div class="search-container">
        <button class="btn" onclick="execDaumPostcode()">ì£¼ì†Œ ê²€ìƒ‰í•˜ê¸°</button>
        <div id="address-display">ê²€ìƒ‰ëœ ì£¼ì†Œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
    </div>

    <div id="result-area">
        <p>ì¡°íšŒ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
    </div>

    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script>
        // ì´íƒœí¬ë‹˜ì´ ì œê³µí•´ì£¼ì‹  Encoding ì¸ì¦í‚¤
        const SERVICE_KEY = 'qxYCqkstCZ8XGIddZD07gVxLSNV8Ivpcp4QNatFfp4nS3lmhVB4kg1F4%2BPoFnHGjlKViFlvHtKGzNpcR4WIHbw%3D%3D';

        function execDaumPostcode() {
            new daum.Postcode({
                oncomplete: function(data) {
                    // ì£¼ì†Œ í‘œì‹œ
                    document.getElementById('address-display').innerText = "ğŸ“ " + data.address;
                    // ê±´ì¶•ë¬¼ëŒ€ì¥ API í˜¸ì¶œ ì‹œì‘
                    fetchBuildingInfo(data);
                }
            }).open();
        }

        async function fetchBuildingInfo(addrData) {
            const resultArea = document.getElementById('result-area');
            resultArea.innerHTML = "<p>â³ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>";

            // 1. íŒŒë¼ë¯¸í„° ì¤€ë¹„ [cite: 28, 33]
            // sigunguCd: ì‹œêµ°êµ¬ì½”ë“œ(5ìë¦¬), bjdongCd: ë²•ì •ë™ì½”ë“œ(5ìë¦¬)
            const sigunguCd = addrData.sigunguCode;
            const bjdongCd = addrData.bjdongCode;
            const bun = addrData.bun.padStart(4, '0'); // ë²ˆ(4ìë¦¬ ë§ì¶¤) [cite: 21]
            const ji = addrData.ji.padStart(4, '0');   // ì§€(4ìë¦¬ ë§ì¶¤) [cite: 21]

            // 2. ê±´ì¶•HUB í‘œì œë¶€ ì¡°íšŒ URL êµ¬ì„±
            const url = `https://apis.data.go.kr/1613000/BldRgstHubService/getBrTitleInfo?serviceKey=${SERVICE_KEY}&sigunguCd=${sigunguCd}&bjdongCd=${bjdongCd}&bun=${bun}&ji=${ji}&_type=json`;

            try {
                const response = await fetch(url);
                const json = await response.json();

                // 3. ë°ì´í„° ìœ ë¬´ í™•ì¸ ë° ê²°ê³¼ ì²˜ë¦¬
                const items = json.response.body.items;

                if (!items || items === "") {
                    resultArea.innerHTML = "<p class='error'>âŒ í•´ë‹¹ ì£¼ì†Œì— ë“±ë¡ëœ ê±´ì¶•ë¬¼ëŒ€ì¥ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ì‹ ì¶• ê±´ë¬¼ì´ê±°ë‚˜ ì£¼ì†Œê°€ ì •í™•í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.)</p>";
                    return;
                }

                const item = Array.isArray(items.item) ? items.item[0] : items.item;

                // 4. ë³´ê¸° ì¢‹ê²Œ ì •ë¦¬í•´ì„œ ë³´ì—¬ì£¼ê¸°
                resultArea.innerHTML = `
                    <h3>âœ… ì¡°íšŒ ì„±ê³µ: ${item.bldNm || 'ê±´ë¬¼ëª… ì—†ìŒ'}</h3>
                    <table class="info-table">
                        <tr><th>ëŒ€ì§€ìœ„ì¹˜</th><td>${item.platPlc}</td></tr>
                        <tr><th>ë„ë¡œëª…ì£¼ì†Œ</th><td>${item.newPlatPlc || '-'}</td></tr>
                        <tr><th>ì£¼ìš©ë„</th><td>${item.mainPurpsCdNm}</td></tr>
                        <tr><th>êµ¬ì¡°</th><td>${item.strctCdNm}</td></tr>
                        <tr><th>ì¸µìˆ˜</th><td>ì§€ìƒ ${item.grndFlrCnt}ì¸µ / ì§€í•˜ ${item.ugrndFlrCnt}ì¸µ</td></tr>
                        <tr><th>ì—°ë©´ì </th><td>${item.totArea} ã¡</td></tr>
                        <tr><th>ì‚¬ìš©ìŠ¹ì¸ì¼</th><td>${item.useAprDay || 'ì •ë³´ ì—†ìŒ'}</td></tr>
                    </table>
                `;
            } catch (error) {
                resultArea.innerHTML = "<p class='error'>âš ï¸ API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>";
                console.error(error);
            }
        }
    </script>
</body>
</html>